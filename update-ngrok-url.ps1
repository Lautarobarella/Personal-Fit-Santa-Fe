# Script para actualizar la URL de ngrok din√°micamente
param(
    [Parameter(Mandatory=$true)]
    [string]$NgrokUrl
)

Write-Host "üîÑ Actualizando URL de ngrok a: $NgrokUrl" -ForegroundColor Green

# Verificar que la URL sea v√°lida
if (-not $NgrokUrl.StartsWith("https://")) {
    Write-Host "‚ùå Error: La URL debe comenzar con https://" -ForegroundColor Red
    exit 1
}

# Actualizar el archivo .env.ngrok
if (Test-Path ".env.ngrok") {
    $content = Get-Content ".env.ngrok" -Raw
    $content = $content -replace "NGROK_URL=.*", "NGROK_URL=$NgrokUrl"
    Set-Content ".env.ngrok" $content
    Write-Host "‚úÖ Archivo .env.ngrok actualizado" -ForegroundColor Green
} else {
    Write-Host "‚ö†Ô∏è  Archivo .env.ngrok no encontrado. Creando uno nuevo..." -ForegroundColor Yellow
    Copy-Item "env.ngrok.example" ".env.ngrok"
    $content = Get-Content ".env.ngrok" -Raw
    $content = $content -replace "NGROK_URL=.*", "NGROK_URL=$NgrokUrl"
    Set-Content ".env.ngrok" $content
    Write-Host "‚úÖ Archivo .env.ngrok creado y actualizado" -ForegroundColor Green
}

# Reiniciar el frontend para aplicar los cambios
Write-Host "üîÑ Reiniciando frontend para aplicar los cambios..." -ForegroundColor Yellow
docker-compose -f docker-compose.ngrok.yml restart personalfit-frontend

Write-Host ""
Write-Host "‚úÖ URL de ngrok actualizada correctamente!" -ForegroundColor Green
Write-Host "üåê Tu aplicaci√≥n ahora est√° disponible en: $NgrokUrl" -ForegroundColor Cyan
Write-Host ""
Write-Host "üìã URLs de acceso:" -ForegroundColor Yellow
Write-Host "   Frontend (ngrok): $NgrokUrl" -ForegroundColor White
Write-Host "   Backend API (local): http://localhost:8080" -ForegroundColor White
Write-Host "   PgAdmin (local): http://localhost:5050" -ForegroundColor White
Write-Host ""
Write-Host "üîó MercadoPago webhooks ahora funcionar√°n correctamente con HTTPS" -ForegroundColor Green

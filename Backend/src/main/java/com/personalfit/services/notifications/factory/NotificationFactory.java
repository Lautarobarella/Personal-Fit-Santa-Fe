package com.personalfit.services.notifications.factory;

import com.personalfit.enums.NotificationStatus;
import com.personalfit.enums.UserRole;
import com.personalfit.models.Notification;
import com.personalfit.models.User;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

/**
 * Factory para crear diferentes tipos de notificaciones
 * Centraliza la l√≥gica de creaci√≥n de notificaciones espec√≠ficas
 */
@Component
public class NotificationFactory {
    
    /**
     * Crea notificaciones de pago vencido para una lista de usuarios
     * @param users Usuarios con pagos vencidos
     * @return Lista de notificaciones creadas
     */
    public List<Notification> createPaymentExpiredNotifications(List<User> users) {
        List<Notification> notifications = new ArrayList<>();
        
        for (User user : users) {
            Notification notification = Notification.builder()
                    .title("Pago vencido")
                    .message("Tu pago ha vencido, realiza un pago para renovar tu membres√≠a")
                    .user(user)
                    .date(LocalDateTime.now())
                    .status(NotificationStatus.UNREAD)
                    .targetRole(UserRole.CLIENT)
                    .build();
            notifications.add(notification);
        }
        
        return notifications;
    }
    
    /**
     * Crea notificaciones de cumplea√±os para administradores
     * @param birthdayUsers Usuarios que cumplen a√±os
     * @param admins Administradores que recibir√°n la notificaci√≥n
     * @return Lista de notificaciones creadas
     */
    public List<Notification> createBirthdayNotifications(List<User> birthdayUsers, List<User> admins) {
        List<Notification> notifications = new ArrayList<>();
        
        for (User birthdayUser : birthdayUsers) {
            for (User admin : admins) {
                Notification notification = Notification.builder()
                        .title("Cumple de " + birthdayUser.getFirstName())
                        .message("Hoy es el cumplea√±os de " + birthdayUser.getFullName() + "! Des√©ale un feliz cumplea√±os!")
                        .user(admin)
                        .date(LocalDateTime.now())
                        .status(NotificationStatus.UNREAD)
                        .targetRole(UserRole.ADMIN)
                        .build();
                notifications.add(notification);
            }
        }
        
        return notifications;
    }
    
    /**
     * Crea notificaciones de advertencia por inasistencia
     * @param absentUsers Usuarios con inasistencias prolongadas
     * @param admins Administradores que recibir√°n la notificaci√≥n
     * @return Lista de notificaciones creadas
     */
    public List<Notification> createAttendanceWarningNotifications(List<User> absentUsers, List<User> admins) {
        List<Notification> notifications = new ArrayList<>();
        
        for (User absentUser : absentUsers) {
            for (User admin : admins) {
                Notification notification = Notification.builder()
                        .title("Inasistencia de " + absentUser.getFirstName())
                        .message(absentUser.getFullName() +
                                " hace 4 d√≠as que no asiste al gimnasio. Cont√°ctalo para saber si necesita ayuda.")
                        .user(admin)
                        .date(LocalDateTime.now())
                        .status(NotificationStatus.UNREAD)
                        .targetRole(UserRole.ADMIN)
                        .build();
                notifications.add(notification);
            }
        }
        
        return notifications;
    }
    
    /**
     * Crea una notificaci√≥n de recordatorio de pago
     * @param user Usuario que debe pagar
     * @param amount Monto del pago
     * @param dueDate Fecha de vencimiento
     * @return Notificaci√≥n creada
     */
    public Notification createPaymentDueReminderNotification(User user, double amount, LocalDateTime dueDate) {
        return Notification.builder()
                .title("üí≥ Recordatorio de Pago")
                .message(String.format("Tu pago de $%.2f vence el %s. ¬°No olvides pagarlo a tiempo!",
                        amount, dueDate.toLocalDate()))
                .user(user)
                .date(LocalDateTime.now())
                .status(NotificationStatus.UNREAD)
                .targetRole(user.getRole())
                .build();
    }
    
    /**
     * Crea una notificaci√≥n de confirmaci√≥n de pago
     * @param user Usuario que realiz√≥ el pago
     * @param amount Monto del pago
     * @param paymentMethod M√©todo de pago utilizado
     * @return Notificaci√≥n creada
     */
    public Notification createPaymentConfirmationNotification(User user, double amount, String paymentMethod) {
        return Notification.builder()
                .title("‚úÖ Pago Verificado")
                .message(String.format("¬°Tu pago ha sido verificado con √©xito de $%.2f via %s!",
                        amount, paymentMethod))
                .user(user)
                .date(LocalDateTime.now())
                .status(NotificationStatus.UNREAD)
                .targetRole(user.getRole())
                .build();
    }
    
    /**
     * Crea una notificaci√≥n de recordatorio de clase
     * @param user Usuario inscrito en la clase
     * @param className Nombre de la clase
     * @param classTime Hora de la clase
     * @param location Ubicaci√≥n de la clase
     * @return Notificaci√≥n creada
     */
    public Notification createClassReminderNotification(User user, String className, LocalDateTime classTime, String location) {
        return Notification.builder()
                .title("üèÉ‚Äç‚ôÄÔ∏è Recordatorio de Clase")
                .message(String.format("Tu clase de %s comienza en 1 hora (%s). Ubicaci√≥n: %s",
                        className, classTime.toLocalTime(), location))
                .user(user)
                .date(LocalDateTime.now())
                .status(NotificationStatus.UNREAD)
                .targetRole(user.getRole())
                .build();
    }
    
    /**
     * Crea una notificaci√≥n de meta alcanzada
     * @param user Usuario que alcanz√≥ la meta
     * @param achievement Descripci√≥n del logro
     * @return Notificaci√≥n creada
     */
    public Notification createGoalAchievementNotification(User user, String achievement) {
        return Notification.builder()
                .title("üèÜ ¬°Meta Alcanzada!")
                .message(String.format("¬°Felicitaciones %s! Has alcanzado tu meta: %s. ¬°Sigue as√≠!",
                        user.getFirstName(), achievement))
                .user(user)
                .date(LocalDateTime.now())
                .status(NotificationStatus.UNREAD)
                .targetRole(user.getRole())
                .build();
    }
    
    /**
     * Crea una notificaci√≥n general/anuncio
     * @param user Usuario que recibir√° el anuncio
     * @param title T√≠tulo del anuncio
     * @param message Mensaje del anuncio
     * @return Notificaci√≥n creada
     */
    public Notification createGeneralAnnouncementNotification(User user, String title, String message) {
        return Notification.builder()
                .title("üì¢ " + title)
                .message(message)
                .user(user)
                .date(LocalDateTime.now())
                .status(NotificationStatus.UNREAD)
                .targetRole(user.getRole())
                .build();
    }
}